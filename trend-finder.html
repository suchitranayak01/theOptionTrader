<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Trend Finder - TheOptionTrader</title>
    <link rel="stylesheet" href="style.css" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <style>
      .trend-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 40px 20px;
        background: #02101a;
        min-height: 100vh;
      }

      .page-header {
        text-align: center;
        margin-bottom: 40px;
        padding: 40px 20px;
        background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        border-radius: 12px;
      }

      .page-header h1 {
        font-size: 3rem;
        color: #e6eef8;
        margin-bottom: 1rem;
      }

      .page-header p {
        font-size: 1.2rem;
        color: #94a3b8;
      }

      .search-section {
        background: rgba(59, 130, 246, 0.05);
        border: 1px solid rgba(59, 130, 246, 0.2);
        border-radius: 12px;
        padding: 30px;
        margin-bottom: 30px;
      }

      .search-box {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
      }

      .search-box input {
        flex: 1;
        padding: 14px;
        background: #0f172a;
        border: 1px solid #334155;
        border-radius: 8px;
        color: #e6eef8;
        font-size: 1rem;
      }

      .search-box input:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }

      .search-btn {
        background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
        color: white;
        padding: 14px 32px;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .search-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
      }

      .quick-picks {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      .quick-pick-btn {
        background: rgba(59, 130, 246, 0.1);
        border: 1px solid rgba(59, 130, 246, 0.3);
        color: #94a3b8;
        padding: 8px 16px;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 0.9rem;
      }

      .quick-pick-btn:hover {
        background: rgba(59, 130, 246, 0.2);
        border-color: #3b82f6;
        color: #e6eef8;
      }

      .trend-grid {
        display: grid;
        grid-template-columns: 1fr 400px;
        gap: 20px;
        margin-bottom: 30px;
      }

      .card {
        background: rgba(59, 130, 246, 0.05);
        border: 1px solid rgba(59, 130, 246, 0.2);
        border-radius: 12px;
        padding: 25px;
      }

      .card h3 {
        color: #e6eef8;
        margin-bottom: 1.5rem;
        font-size: 1.5rem;
      }

      .chart-container {
        background: #0f172a;
        border-radius: 8px;
        height: 500px;
      }

      .analysis-item {
        padding: 15px;
        background: rgba(59, 130, 246, 0.05);
        border-left: 3px solid #3b82f6;
        border-radius: 6px;
        margin-bottom: 15px;
      }

      .analysis-item.bullish {
        border-left-color: #22c55e;
        background: rgba(34, 197, 94, 0.05);
      }

      .analysis-item.bearish {
        border-left-color: #ef4444;
        background: rgba(239, 68, 68, 0.05);
      }

      .analysis-item .label {
        color: #94a3b8;
        font-size: 0.85rem;
        margin-bottom: 5px;
      }

      .analysis-item .value {
        color: #e6eef8;
        font-size: 1.2rem;
        font-weight: 600;
        font-family: 'Orbitron', monospace;
      }

      .ma-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
        margin-top: 10px;
      }

      .ma-item {
        background: rgba(59, 130, 246, 0.05);
        padding: 12px;
        border-radius: 6px;
        text-align: center;
      }

      .ma-item .ma-label {
        color: #94a3b8;
        font-size: 0.8rem;
      }

      .ma-item .ma-value {
        color: #e6eef8;
        font-weight: 600;
        font-size: 1.1rem;
        margin-top: 4px;
      }

      .trend-badge {
        display: inline-block;
        padding: 6px 14px;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.9rem;
        margin-top: 10px;
      }

      .trend-badge.bullish {
        background: rgba(34, 197, 94, 0.2);
        color: #22c55e;
      }

      .trend-badge.bearish {
        background: rgba(239, 68, 68, 0.2);
        color: #ef4444;
      }

      .trend-badge.neutral {
        background: rgba(148, 163, 184, 0.2);
        color: #94a3b8;
      }

      /* Prediction Section */
      .prediction-section {
        background: rgba(59, 130, 246, 0.05);
        border: 1px solid rgba(59, 130, 246, 0.2);
        border-radius: 12px;
        padding: 30px;
        margin: 30px 0;
      }

      .prediction-result {
        text-align: center;
        padding: 30px;
        border-radius: 12px;
        margin: 20px 0;
      }

      .prediction-result.BULLISH {
        background: linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(34, 197, 94, 0.05));
        border: 2px solid #22c55e;
      }

      .prediction-result.BEARISH {
        background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(239, 68, 68, 0.05));
        border: 2px solid #ef4444;
      }

      .prediction-result.NEUTRAL {
        background: linear-gradient(135deg, rgba(148, 163, 184, 0.2), rgba(148, 163, 184, 0.05));
        border: 2px solid #94a3b8;
      }

      .prediction-label {
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 10px;
      }

      .BULLISH .prediction-label { color: #22c55e; }
      .BEARISH .prediction-label { color: #ef4444; }
      .NEUTRAL .prediction-label { color: #94a3b8; }

      .confidence-meter {
        width: 100%;
        height: 20px;
        background: rgba(51, 65, 85, 0.5);
        border-radius: 10px;
        overflow: hidden;
        margin: 15px 0;
      }

      .confidence-fill {
        height: 100%;
        background: linear-gradient(90deg, #3b82f6, #22c55e);
        transition: width 0.5s ease;
        display: flex;
        align-items: center;
        justify-content: flex-end;
        padding-right: 8px;
        color: white;
        font-weight: 600;
        font-size: 0.85rem;
      }

      .signals-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 12px;
        margin: 15px 0;
      }

      .signal-item {
        background: rgba(51, 65, 85, 0.3);
        padding: 12px;
        border-radius: 6px;
        text-align: center;
      }

      .signal-label {
        font-size: 0.75rem;
        color: #94a3b8;
        margin-bottom: 5px;
      }

      .signal-value {
        font-size: 0.95rem;
        font-weight: 600;
        color: #e6eef8;
      }

      .insight {
        background: rgba(59, 130, 246, 0.1);
        padding: 10px 12px;
        margin: 6px 0;
        border-radius: 6px;
        border-left: 3px solid #3b82f6;
        color: #e6eef8;
        font-size: 0.9rem;
      }

      .pcr-input-group {
        margin: 15px 0;
      }

      .pcr-input-group label {
        display: block;
        color: #94a3b8;
        margin-bottom: 8px;
        font-weight: 500;
      }

      .pcr-input-group input {
        width: 100%;
        padding: 10px;
        background: rgba(15, 23, 42, 0.8);
        border: 1px solid #334155;
        border-radius: 6px;
        color: #e6eef8;
        font-size: 0.95rem;
      }

      @media (max-width: 1024px) {
        .trend-grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <header class="app-header">
      <div class="app-title">
        <a href="index.html" style="text-decoration: none;">
          <div class="brand" style="cursor: pointer;">
            <img src="logo.svg" alt="TheOptionTrader" style="width: 68px; height: 68px;" class="logo-image"/>
            <h1 class="logo">TheOptionTrader</h1>
          </div>
        </a>
      </div>
      <div class="header-actions">
        <a class="btn ghost" href="index.html">Home</a>
        <a class="btn ghost" href="Options360.html">Options 360</a>
        <a class="btn ghost" href="login.html">Login</a>
      </div>
    </header>

    <div class="trend-container">
      <div class="page-header">
        <h1>üìà Trend Finder & AI Prediction</h1>
        <p>Analyze stock trends and get AI-powered market predictions based on price movement & PCR data</p>
      </div>

      <div class="search-section">
        <div class="search-box">
          <input type="text" id="symbolSearch" placeholder="Enter stock symbol (e.g., RELIANCE, TCS, INFY)" />
          <button class="search-btn" onclick="analyzeTrend()">Analyze Trend</button>
        </div>
        <div class="quick-picks">
          <button class="quick-pick-btn" onclick="quickAnalyze('NSE:NIFTY')">Nifty 50</button>
          <button class="quick-pick-btn" onclick="quickAnalyze('NSE:BANKNIFTY')">Bank Nifty</button>
          <button class="quick-pick-btn" onclick="quickAnalyze('NSE:RELIANCE')">Reliance</button>
          <button class="quick-pick-btn" onclick="quickAnalyze('NSE:TCS')">TCS</button>
          <button class="quick-pick-btn" onclick="quickAnalyze('NSE:INFY')">Infosys</button>
          <button class="quick-pick-btn" onclick="quickAnalyze('NSE:HDFCBANK')">HDFC Bank</button>
        </div>
      </div>

      <div class="trend-grid">
        <div class="card">
          <h3>üìä Price Chart</h3>
          <div id="tradingview_chart" class="chart-container"></div>
        </div>

        <div class="card">
          <h3>üîç Technical Analysis</h3>
          
          <div class="analysis-item" id="trendAnalysis">
            <div class="label">Current Trend</div>
            <div class="value" id="trendValue">-</div>
            <div class="trend-badge neutral" id="trendBadge">Analyzing...</div>
          </div>

          <div class="analysis-item" id="resistanceAnalysis">
            <div class="label">Nearest Resistance</div>
            <div class="value" id="resistanceValue">-</div>
          </div>

          <div class="analysis-item" id="supportAnalysis">
            <div class="label">Nearest Support</div>
            <div class="value" id="supportValue">-</div>
          </div>

          <div class="analysis-item">
            <div class="label">Moving Averages</div>
            <div class="ma-grid">
              <div class="ma-item">
                <div class="ma-label">20 SMA</div>
                <div class="ma-value" id="ma20">-</div>
              </div>
              <div class="ma-item">
                <div class="ma-label">50 SMA</div>
                <div class="ma-value" id="ma50">-</div>
              </div>
              <div class="ma-item">
                <div class="ma-label">100 SMA</div>
                <div class="ma-value" id="ma100">-</div>
              </div>
              <div class="ma-item">
                <div class="ma-label">200 SMA</div>
                <div class="ma-value" id="ma200">-</div>
              </div>
            </div>
          </div>

          <div class="analysis-item" id="volumeAnalysis">
            <div class="label">Volume Trend</div>
            <div class="value" id="volumeValue">-</div>
          </div>

          <div class="analysis-item" id="rsiAnalysis">
            <div class="label">RSI (14)</div>
            <div class="value" id="rsiValue">-</div>
          </div>
        </div>
      </div>

      <!-- AI Prediction Section -->
      <div class="prediction-section">
        <h3 style="margin-bottom: 20px;">ü§ñ AI Market Prediction</h3>
        
        <div class="pcr-input-group">
          <label>Current PCR (Put-Call Ratio)</label>
          <input type="number" id="pcrInput" placeholder="e.g., 0.85" step="0.01" value="0.85">
          <button class="search-btn" style="margin-top: 10px; width: 100%;" onclick="runPrediction()">üîÆ Generate AI Prediction</button>
        </div>

        <div id="predictionContainer" style="display: none;">
          <div id="predictionResult" class="prediction-result">
            <div class="prediction-label" id="predictionLabel">-</div>
            <div style="font-size: 1rem; color: #94a3b8; margin-bottom: 10px;">
              Score: <span id="predictionScore">0</span> | Confidence: <span id="confidenceText">0%</span>
            </div>
            <div class="confidence-meter">
              <div class="confidence-fill" id="confidenceFill"></div>
            </div>
          </div>

          <div class="card">
            <h4 style="margin-bottom: 15px;">üìä Technical Signals</h4>
            <div class="signals-grid" id="signalsGrid"></div>
          </div>

          <div class="card" style="margin-top: 15px;">
            <h4 style="margin-bottom: 15px;">üß† AI Analysis</h4>
            <div id="analysisContainer"></div>
          </div>
        </div>
      </div>
    </div>

    <footer class="footer" style="background: #0f172a; text-align: center; padding: 40px 20px; border-top: 1px solid #334155;">
      <p style="color: #64748b;">&copy; 2026 TheOptionTrader. Technical analysis made simple.</p>
    </footer>

    <script src="prediction-engine.js"></script>
    <script src="prediction-engine.js"></script>
    <script>
      let currentSymbol = 'NSE:NIFTY';
      let tvWidget = null;
      let priceHistory = [];
      const predictionEngine = new PredictionEngine();

      function initTradingView(symbol) {
        if (tvWidget) {
          tvWidget.remove();
        }

        tvWidget = new TradingView.widget({
          "autosize": true,
          "symbol": symbol,
          "interval": "D",
          "timezone": "Asia/Kolkata",
          "theme": "dark",
          "style": "1",
          "locale": "en",
          "toolbar_bg": "#0f172a",
          "enable_publishing": false,
          "hide_top_toolbar": false,
          "hide_legend": false,
          "save_image": false,
          "container_id": "tradingview_chart",
          "studies": [
            "MASimple@tv-basicstudies",
            "RSI@tv-basicstudies"
          ],
          "disabled_features": ["header_symbol_search"],
          "enabled_features": ["study_templates"],
          "overrides": {
            "paneProperties.background": "#0f172a",
            "paneProperties.backgroundType": "solid"
          }
        });
      }

      function quickAnalyze(symbol) {
        document.getElementById('symbolSearch').value = symbol;
        analyzeTrend();
      }

      function analyzeTrend() {
        let symbol = document.getElementById('symbolSearch').value.trim().toUpperCase();
        
        if (!symbol) return;
        
        // Add NSE: prefix if not present
        if (!symbol.includes(':')) {
          symbol = 'NSE:' + symbol;
        }
        
        currentSymbol = symbol;
        initTradingView(symbol);
        
        // Simulate analysis (in production, fetch from API)
        simulateAnalysis();
      }

      function simulateAnalysis() {
        // Generate random but realistic looking data
        const currentPrice = 23000 + Math.random() * 2000;
        const resistance = currentPrice + (Math.random() * 200 + 50);
        const support = currentPrice - (Math.random() * 200 + 50);
        
        const ma20 = currentPrice * (0.98 + Math.random() * 0.04);
        const ma50 = currentPrice * (0.96 + Math.random() * 0.06);
        const ma100 = currentPrice * (0.94 + Math.random() * 0.08);
        const ma200 = currentPrice * (0.92 + Math.random() * 0.1);
        
        const rsi = 30 + Math.random() * 40;
        
        // Generate price history for prediction
        priceHistory = generatePriceHistory(currentPrice);
        
        // Determine trend
        let trend = 'Neutral';
        let trendClass = 'neutral';
        if (currentPrice > ma20 && ma20 > ma50 && ma50 > ma200) {
          trend = 'Higher Highs (HH) - Strong Uptrend';
          trendClass = 'bullish';
        } else if (currentPrice < ma20 && ma20 < ma50 && ma50 < ma200) {
          trend = 'Lower Lows (LL) - Strong Downtrend';
          trendClass = 'bearish';
        } else if (currentPrice > ma50) {
          trend = 'Consolidation with Bullish Bias';
          trendClass = 'neutral';
        } else {
          trend = 'Consolidation with Bearish Bias';
          trendClass = 'neutral';
        }
        
        document.getElementById('trendValue').textContent = trend;
        document.getElementById('trendBadge').textContent = trendClass === 'bullish' ? 'BULLISH' : trendClass === 'bearish' ? 'BEARISH' : 'NEUTRAL';
        document.getElementById('trendBadge').className = `trend-badge ${trendClass}`;
        document.getElementById('trendAnalysis').className = `analysis-item ${trendClass}`;
        
        document.getElementById('resistanceValue').textContent = `‚Çπ${resistance.toFixed(2)}`;
        document.getElementById('supportValue').textContent = `‚Çπ${support.toFixed(2)}`;
        
        document.getElementById('ma20').textContent = `‚Çπ${ma20.toFixed(2)}`;
        document.getElementById('ma50').textContent = `‚Çπ${ma50.toFixed(2)}`;
        document.getElementById('ma100').textContent = `‚Çπ${ma100.toFixed(2)}`;
        document.getElementById('ma200').textContent = `‚Çπ${ma200.toFixed(2)}`;
        
        const volumeTrend = Math.random() > 0.5 ? 'Increasing' : 'Decreasing';
        document.getElementById('volumeValue').textContent = volumeTrend;
        
        const rsiText = rsi < 30 ? 'Oversold' : rsi > 70 ? 'Overbought' : 'Neutral';
        document.getElementById('rsiValue').textContent = `${rsi.toFixed(1)} (${rsiText})`;
      }

      function generatePriceHistory(currentPrice) {
        const history = [];
        let price = currentPrice * 0.95;
        
        for (let i = 0; i < 20; i++) {
          const change = (Math.random() - 0.45) * (currentPrice * 0.02);
          price += change;
          history.push({
            price: price,
            timestamp: new Date(Date.now() - (20 - i) * 86400000)
          });
        }
        
        return history;
      }

      function runPrediction() {
        const pcrValue = parseFloat(document.getElementById('pcrInput').value);
        
        if (!pcrValue || priceHistory.length === 0) {
          alert('Please analyze a stock first before running prediction');
          return;
        }

        // Run prediction
        const result = predictionEngine.predict(priceHistory, pcrValue);
        
        // Display results
        displayPrediction(result);
      }

      function displayPrediction(result) {
        document.getElementById('predictionContainer').style.display = 'block';
        
        const resultDiv = document.getElementById('predictionResult');
        resultDiv.className = 'prediction-result ' + result.prediction;
        
        document.getElementById('predictionLabel').textContent = result.prediction;
        document.getElementById('predictionScore').textContent = result.score;
        document.getElementById('confidenceText').textContent = result.confidence + '%';
        document.getElementById('confidenceFill').style.width = result.confidence + '%';

        // Display signals
        const signalsGrid = document.getElementById('signalsGrid');
        signalsGrid.innerHTML = '';
        Object.entries(result.signals).forEach(([key, value]) => {
          signalsGrid.innerHTML += `
            <div class="signal-item">
              <div class="signal-label">${key.toUpperCase()}</div>
              <div class="signal-value">${value}</div>
            </div>
          `;
        });

        // Display analysis
        const analysisContainer = document.getElementById('analysisContainer');
        analysisContainer.innerHTML = result.analysis.map(insight => 
          `<div class="insight">${insight}</div>`
        ).join('');

        // Scroll to prediction
        document.getElementById('predictionContainer').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      }

      // Initialize with Nifty
      initTradingView(currentSymbol);
      simulateAnalysis();

      // Handle Enter key
      document.getElementById('symbolSearch').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          analyzeTrend();
        }
      });
    </script>
      <script src="auth.js"></script>
</body>
</html>
